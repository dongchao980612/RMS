# 接口篇

## 1 查询文章列表

在"routes"目录下新建"admin/article.js"文件，编写如下代码：

```javascript
const express = require('express');
const router = express.Router();

/* GET home page. */
router.get('/', function (req, res, next) {
    res.json({ message: '这里是后台文章的接口' });
});

module.exports = router;
```

修改app.js文件，引入刚才创建的路由文件：

```javascript
//后台路由文件
const adminArticlesRouter = require('./routes/admin/articles');

//后台路由配置
app.use('/admin/articles', adminArticlesRouter);
```

### 1. 配置路由

```js
const { Article } = require('../../models');

router.get('/', async function (req, res, next) {

});
```

### 2. 查询数据库

```js
const articles = await Article.findAll(condition);

res.json({
    code: true,
    data: articles,
    message: '文章列表获取成功'
});
```

### 3. 数据排序

```js
const condition = {
    order: [['id', 'DESC']]
};

const articles = await Article.findAll(condition);
```

### 4. 异常处理

```js
try {
    const condition = {
        order: [['id', 'DESC']]
    };

    const articles = await Article.findAll(condition);

    res.json({
        code: true,
        data: articles,
        message: '文章列表获取成功'
    });
} catch (error) {
    res.status(500).json({
        code: false,
        data: [],
        message: '文章列表获取失败',
        errors: [error.message]
    });
}
```

## 2 查询文章详情

### 1. 在路由中添加id参数

```js
router.get('/:id', async function (req, res, next) {

});

 ```

### 2. 如何查询查文章详情

```js
const article = await Article.findByPk(id)

res.json({
code: true,
data: article,
message: '文章详情获取成功'
});

```

#### 3. 查询不存在的数据怎么办

```js
if (!article) {
    return res.status(404).json({
        code: false,
        message: '文章不存在'
    });
}
```

## 3 Paifox的使用

### 1. Paifox是什么

### 2. 如何新建项目

### 3. 如何调试接口

### 4. 环境变量如何设置

- 环境设置->开发环境

### 5 如何导出接口文档

- 分享文档

## 4 创建文章

### 1. POST请求

```js
router.post('/', async function (req, res, next) {
    
});
```

### 2. Apifox如何发送POST请求

### 3. 如何存入数据库

```js
const article = await Article.create(req.body);
```

### 4. 200与201状态码的区别

## 5 删除文章

### 1. DELETE请求

```js
router.delete('/:id', async function (req, res, next) {
});
```

### 2. 删除文章怎样实现

```js
const { id } = req.params;
const article = await Article.findByPk(id);
await article.destroy();
```

## 6 更新文章

### 1. PUT请求

```js
router.put('/:id', async function (req, res, next) {
});
```

### 2. 更新文章怎样实现

```js
const { id } = req.params;
const article = await Article.findByPk(id);
await article.update(req.body);
```

## 7 模糊搜索

### 1. 如何搜索文章

sql语句：

```sql
select * from Articles where title like '%标题 10%'
```

接口设计:

```js
/articles?title=标题 10   req.query
/articles/1 req.params
```

### 2. SQL中的like和%

### 3. req.query如何获取参数

```js
const query = req.query;
```

### 4. Nodejs中的模糊搜索

```js
if (query.title) {
    condition.where = {
        title: {
            [Op.like]: `%${query.title}%`
        }
    };
}
```

## 8 数据分页

### 1. 分页是什么

sql语句：

```sql
select * from Articles where title limit 0,10
select * from Articles where title limit 20,10
select * from Articles where title limit 30,10
```

### 2. 分页原理与计算公式

```js
/articles?currentPage=1&pageSize=10
```

### 在Node.js中如何实现分页

```js
const currentPage = Math.abs(parseInt(query.currentPage)) || 1;
const pageSize = Math.abs(parseInt(query.pageSize)) || 10;

const offset = (currentPage - 1) * pageSize;

const condition = {
    order: [['id', 'ASC']],
    limit: pageSize,
    offset: offset
};

const { count, rows } = await Article.findAndCountAll(condition);

res.json({
    status: true,
    pagination: {
        total: count,
        currentPage,
        pageSize
    },
    data: rows,
    message: '文章列表获取成功'
});

```
